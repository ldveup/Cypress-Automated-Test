name: Esegui test Cypress

on:
  push:
    branches:
      - main

jobs:
  cypress-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout codice
        uses: actions/checkout@v3

      - name: Imposta Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Installa dipendenze
        run: npm install

      - name: Verifica installazione Cypress
        run: npx cypress verify

      - name: Esegui test Cypress
        run: |
          mkdir -p results
          for f in cypress/e2e/EasyMap\ Test\ Library/*.cy.js; do
            filename=$(basename "$f" .cy.js)
            npx cypress run --spec "$f" --reporter junit --reporter-options "mochaFile=results/${filename}-Output.xml"
          done

      - name: Carica report JUnit come artifact
        uses: actions/upload-artifact@v4
        with:
          name: cypress-junit-reports
          path: results/*.xml
